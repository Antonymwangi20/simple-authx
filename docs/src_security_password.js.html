<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/security/password.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-core_auth.AuthManager.html">AuthManager</a><ul class='methods'><li data-type='method'><a href="module-core_auth.AuthManager.html#generateTokens">generateTokens</a></li><li data-type='method'><a href="module-core_auth.AuthManager.html#login">login</a></li><li data-type='method'><a href="module-core_auth.AuthManager.html#loginWithIdentifier">loginWithIdentifier</a></li><li data-type='method'><a href="module-core_auth.AuthManager.html#refresh">refresh</a></li><li data-type='method'><a href="module-core_auth.AuthManager.html#register">register</a></li></ul></li><li><a href="module-core_auth-AuthManager.html">AuthManager</a></li><li><a href="module-security_audit.AuditLogger.html">AuditLogger</a></li><li><a href="module-security_audit-AuditLogger.html">AuditLogger</a></li><li><a href="module-security_security.SecurityManager.html">SecurityManager</a></li><li><a href="module-security_security-SecurityManager.html">SecurityManager</a></li></ul><h3>Modules</h3><ul><li><a href="module-core_auth.html">core/auth</a></li><li><a href="module-core_unified-api.html">core/unified-api</a><ul class='methods'><li data-type='method'><a href="module-core_unified-api.html#.createAuth">createAuth</a></li><li data-type='method'><a href="module-core_unified-api.html#~addMFARoutes">addMFARoutes</a></li><li data-type='method'><a href="module-core_unified-api.html#~addSessionRoutes">addSessionRoutes</a></li><li data-type='method'><a href="module-core_unified-api.html#~addSocialRoutes">addSocialRoutes</a></li><li data-type='method'><a href="module-core_unified-api.html#~createMemoryAdapter">createMemoryAdapter</a></li><li data-type='method'><a href="module-core_unified-api.html#~createProtectMiddleware">createProtectMiddleware</a></li><li data-type='method'><a href="module-core_unified-api.html#~createRouter">createRouter</a></li><li data-type='method'><a href="module-core_unified-api.html#~normalizeConfig">normalizeConfig</a></li><li data-type='method'><a href="module-core_unified-api.html#~setupAdapter">setupAdapter</a></li><li data-type='method'><a href="module-core_unified-api.html#~setupPlugins">setupPlugins</a></li></ul></li><li><a href="module-security_audit.html">security/audit</a></li><li><a href="module-security_security.html">security/security</a></li><li><a href="module-simple-authx.html">simple-authx</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getAuth">getAuth</a></li><li><a href="global.html#getDefaultConfig">getDefaultConfig</a></li><li><a href="global.html#hasherName">hasherName</a></li><li><a href="global.html#initializeAuth">initializeAuth</a></li><li><a href="global.html#isAuthInitialized">isAuthInitialized</a></li><li><a href="global.html#protect">protect</a></li><li><a href="global.html#resetAuth">resetAuth</a></li><li><a href="global.html#verifyPassword">verifyPassword</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">src/security/password.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import bcrypt from 'bcryptjs';
import argon2 from 'argon2';
import zxcvbn from 'zxcvbn'; // Password strength estimator
import crypto from 'crypto';

export class PasswordManager {
  constructor(config = {}) {
    this.minStrength = config.minStrength || 3; // 0-4 zxcvbn strength score
    this.historyLimit = config.historyLimit || 5; // Remember last 5 passwords
    this.maxAge = config.maxAge || 90 * 24 * 60 * 60 * 1000; // 90 days
    this.resetTokenExpiry = config.resetTokenExpiry || 60 * 60 * 1000; // 1 hour
    this.hashAlgo = config.hashAlgo || 'bcrypt'; // 'bcrypt' or 'argon2'
  }

  /**
   * Check password strength without validation (non-throwing)
   * @param {string} password - Password to check
   * @param {string} username - Optional username for context
   * @param {string} email - Optional email for context
   * @returns {object} Password strength analysis
   */
  checkStrength(password, username, email) {
    // Check password strength using zxcvbn
    const inputs = [username, email].filter(Boolean);
    const result = zxcvbn(password, inputs);

    return {
      score: result.score, // 0-4 (0 = weak, 4 = strong)
      feedback: {
        warning: result.feedback.warning || '',
        suggestions: result.feedback.suggestions || [],
      },
      crackTime: result.crack_times_display.offline_fast_hashing_1e10_per_second,
      crackTimeSeconds: result.crack_times_seconds.offline_fast_hashing_1e10_per_second,
    };
  }

  async validatePassword(password, username, email) {
    // Check password strength using zxcvbn
    const result = zxcvbn(password, [username, email]);

    if (result.score &lt; this.minStrength) {
      throw new Error(
        `Password too weak. ${result.feedback.warning}. Suggestions: ${result.feedback.suggestions.join(', ')}`
      );
    }

    return {
      score: result.score,
      feedback: result.feedback,
      estimatedCrackTime: result.crack_times_seconds.offline_fast_hashing_1e10_per_second,
    };
  }

  async hashPassword(password) {
    if (this.hashAlgo === 'argon2') {
      return argon2.hash(password);
    }
    const salt = await bcrypt.genSalt(12);
    return bcrypt.hash(password, salt);
  }

  async verifyPassword(password, hash) {
    if (this.hashAlgo === 'argon2') {
      return argon2.verify(hash, password);
    }
    return bcrypt.compare(password, hash);
  }

  generateResetToken() {
    return {
      token: crypto.randomBytes(32).toString('hex'),
      expires: new Date(Date.now() + this.resetTokenExpiry),
    };
  }

  async checkPasswordHistory(password, history) {
    const checks = await Promise.all(
      history.map((oldHash) => this.verifyPassword(password, oldHash))
    );
    if (checks.some((match) => match)) {
      throw new Error('Password was used recently. Please choose a different password.');
    }
  }

  async enforcePasswordPolicy(username, password, userData = {}) {
    // Check common password patterns
    const commonPatterns = [
      username,
      username.split('').reverse().join(''),
      userData.email,
      userData.birthYear,
      'password',
      '12345678',
    ];

    const hasCommonPattern = commonPatterns.some(
      (pattern) => pattern &amp;&amp; password.toLowerCase().includes(pattern.toLowerCase())
    );
    if (hasCommonPattern) {
      throw new Error('Password contains personal information or common patterns');
    }

    // Check for repeated characters
    if (/(.)\1{2,}/.test(password)) {
      throw new Error('Password contains too many repeated characters');
    }

    // Check for sequential characters
    const sequentialPattern =
      /(?:abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst)/i;
    const sequentialPattern2 = /(?:stu|tuv|uvw|vwx|wxy|xyz|012|123|234|345|456|567|678|789)/i;
    if (sequentialPattern.test(password) || sequentialPattern2.test(password)) {
      throw new Error('Password contains sequential characters');
    }

    return true;
  }

  generateTemporaryPassword() {
    const length = 12;
    const charset =
      'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&amp;*()_+-=[]{}|;:,.&lt;>?';
    let password = '';
    let hasUpper = false;
    let hasLower = false;
    let hasNumber = false;
    let hasSpecial = false;

    while (password.length &lt; length || !hasUpper || !hasLower || !hasNumber || !hasSpecial) {
      const char = charset[Math.floor(Math.random() * charset.length)];
      password += char;

      if (/[A-Z]/.test(char)) hasUpper = true;
      if (/[a-z]/.test(char)) hasLower = true;
      if (/[0-9]/.test(char)) hasNumber = true;
      if (/[^A-Za-z0-9]/.test(char)) hasSpecial = true;
    }

    return password;
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Mon Nov 10 2025 22:45:53 GMT+0300 (East Africa Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
